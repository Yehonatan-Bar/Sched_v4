## מסמך אפיון  

אפליקציית ניהול פרויקטים/משימות אישית (Single User) עם ציר זמן היררכי, ממשק RTL מלא, ותחושת UI “זורמת” עם אינטראקציות חיות.
המטרה היא לאפשר כניסה כמה פעמים ביום כדי להבין מה התקדם ומה נשאר, תוך ניווט מהיר בין רמות פירוט.

---

# קווי יסוד ומסגרת מוצר

* קהל יעד: משתמש יחיד בלבד (אין מערכת משתמשים, הרשאות, הזמנות, התראות)
* שפה: עברית בלבד
* כיווניות: RTL אמיתי מקצה לקצה, כולל ציר זמן מימין לשמאל (עבר מימין, עתיד משמאל)
* פלטפורמה: חובה דסקטופ + מובייל, עם התאמות מחוות (Touch) והנגשה בסיסית
* מצב תצוגה: בהיר/כהה (System + אפשרות ידנית)
* סגנון: נקי אבל חי – אנימציות עדינות, תחושת עומק/השתקפות, “רכיבים שנושמים”
* היקף שימוש: לרוב 3–10 פרויקטים פעילים במקביל, עם אפשרות להעמיק לפרויקט ולמשימותיו

---

# תרחישי שימוש מרכזיים (כדי לכוון ארכיטקטורה)

* “בדיקת מצב מהירה”

  * פתיחה → רואים את כל הפרויקטים כסדרה של קומפוננטות → מזהים מה נעול/בפוקוס ומה בולט
* “התמקדות בפרויקט”

  * נעילה על קומפוננטה → עבודה על ציר זמן, גרירה/זום, עדכון משימות, ירידה לתת־משימות
* “תיעוד”

  * פתיחת מודאל תיאור/מחברת לפרויקט
  * פתיחת מודאל פרטי משימה/תת־משימה מתוך אייקון ליד המשימה
* “שמירה יזומה”

  * המשתמש עורך הרבה מקומית → בסוף לוחץ “שמור” גלובלי → נכתב JSON ונוצר snapshot

> גישת מימוש מומלצת למפתח זה (שונה מעט מהגישה הישירה ב־REST): “Local-first” בדפדפן.
> כל השינויים נרשמים ל־state בצד לקוח + Undo/Redo. רק בלחיצה על “שמור” שולחים state מלא לשרת לשמירה לקובץ + יצירת גיבוי.
> זה מממש בפועל את הדרישה “אין autosave לכל שינוי” בצורה עקבית.

---

# ישויות ומונחים

* פרויקט

  * מופיע בדף הראשי כקומפוננטה שניתנת לגרירה לשינוי סדר
  * כולל טווח זמן ידני (התחלה/סיום) שניתן גם לגרירה
* משימת פרויקט (Milestone)

  * “אבן דרך” על ציר זמן בתוך קומפוננטת הפרויקט
  * יכולה להיות:

    * משימה עם טווח (start/end)
    * משימה נקודתית (point בזמן)
* תת־משימות

  * אותו מודל כמו משימה (TaskNode), מקונן ללא הגבלת עומק
* סטטוסים

  * לא התחיל
  * בתהליך
  * תקוע
  * הושלם
  * מחכה ל: `<שם אדם>` (טקסט בלבד)
* תגיות/עדיפות/צבעים

  * קיימות תגיות + צבעים
  * עדיפות מספרית (לוגיקה פשוטה; אין חישוב אוטומטי)
  * צבע יכול להיות “auto” כדי לאפשר ל־UI להבדיל חפיפות

---

# מסכים ורכיבים

* דף ראשי (Dashboard)

  * רשימת פרויקטים כקומפוננטות אחת מתחת לשנייה
* דף פרויקט (URL נפרד)

  * רשימה שטוחה של כל תתי־המשימות בפרויקט (ללא ציר זמן)
* מודאלים

  * תיאור מפורט לפרויקט
  * מחברת טיוטה לפרויקט (טקסט חופשי)
  * פרטים מלאים למשימה/תת־משימה (נפתח מאייקון ליד המשימה)

---

# דף ראשי: רשימת פרויקטים

## מבנה והתנהגות

* גלילה אנכית להצגת כל הפרויקטים
* שינוי סדר ידני בלבד

  * גרירה מעלה/מטה (דסקטופ)
  * במובייל מומלץ “handle” ברור לגרירה כדי לא להתנגש בגלילה
* אין מיון אוטומטי בכלל

## אפקט “השתקפות + הקטנה לפי עומק”

* ככל שהפרויקט נמוך יותר ברשימה:

  * שכבת ההשתקפות הופכת שקופה יותר
  * כל הקומפוננטה “מתקטנת” בהדרגה
* גבול תחתון: כמעט לא נראה (אבל עדיין קיים כדי לשמר תחושת עומק)
* בדסקטופ:

  * hover על פרויקט מחזיר אותו זמנית לגודל מלא + ביטול שקיפות
* במובייל:

  * tap קצר מתנהג כמו hover (אפקט זמני)

## “Sticky Focus” (נעילה זמנית)

* קליק/טאפ על פרויקט כשהוא במצב מלא:

  * הופך את מצב “גודל מלא + אטימות מלאה” לקבוע עבור אותו פרויקט
* היציאה מהנעילה:

  * רענון הדף
  * או שעה ללא אינטראקציה מאז הקליק האחרון (המאוחר מביניהם לא רלוונטי; הראשון שמתקיים)
* אם גוררים פרויקט נעול – הנעילה נשמרת

## כפתור יצירה

* כפתור “+” צף בתחתית המסך תמיד
* יוצר פרויקט חדש עם ערכי ברירת מחדל מינימליים

  * טווח זמן ברירת מחדל יכול להיות אקראי/גנרי, כדי לתת “משהו לראות” עד שהמשתמש מגדיר ידנית

## נגישות בסיסית

* אפשרות שינוי סדר גם עם מקלדת (כשפרויקט בפוקוס)

  * חיצים להזזה מעלה/מטה

---

# קומפוננטת פרויקט בדף הראשי

## מרכז הקומפוננטה

* עיגול מרכזי עם:

  * שם פרויקט (Inline edit)
  * תיאור קצר (Inline edit)

## אייקונים פעולה

* מעבר לדף פרויקט (URL נפרד)
* פתיחת מודאל תיאור מפורט לפרויקט
* פתיחת מודאל מחברת טיוטה

## ציר זמן בתוך הקומפוננטה (דרגה ראשונה)

* הציר מוצג כחץ מימין לשמאל

  * צד ימין = עבר
  * צד שמאל = עתיד
* טווח ציר (start/end) של הפרויקט:

  * עריכה ידנית (תאריכים)
  * גרירה עם עכבר/אצבע להרחבה/כיווץ/הזזה

---

# ציר זמן: Milestones בתוך פרויקט

## תצוגה

* מעל הציר: תאריכים בפורמט DD/MM/YY
* מתחת לציר:

  * שם משימה + בר זמן (Bar) שמייצג את המשימה
  * שם המשימה מופיע מתחת (לא על הבר, ולא tooltip כברירת מחדל)
* משימה נקודתית:

  * מוצגת כסמן/נקודה בזמן מוגדר

## עריכת זמן (Drag/Resize/Manual)

* גרירה מזיזה את כל הטווח יחד (start+end)
* גרירת קצוות משנה משך (resize)
* עריכה ידנית בתיבות start/end
* Snap תמיד פעיל לפי שנתות רמת הזום

## זום וגלילה

* כלל בסיס:

  * אם הפרויקט נעול וגם העכבר מעל אזור הציר → גלילה עושה זום
  * אחרת גלילה עושה גלילת דף רגילה
* Shift+Scroll:

  * מפעיל זום ביחס לציר הקרוב ביותר לעכבר
* מרכז הזום:

  * הזום מתרכז סביב מרכז הציר (לא סביב העכבר)
* רמות זום:

  * חודשים → שבועות → ימים → שעות → דקות
  * אין רמת “שנים”

## חפיפות משימות

* כשיש overlap:

  * המשימות נשברות לשורות
  * לכל משימה צבע מובחן (גם לשם וגם לבר)
  * קו/מחבר בין שם המשימה לבין הבר על הציר

## סינון/רמזים לפי זום

* נשמרים כללי ההצגה לפי זום
* בזומים רחבים אפשר להציג “רמז” קטן גם למשימות שלא מוצגות במלואן (כדי לא לאבד מודעות)

---

# Drill-down: תתי־משימות בתוך משימה (דרגה שנייה)

* מתחת לציר הראשי מופיעים שמות תתי־המשימות באופן דינמי
* לחיצה על תת־משימה:

  * כל שאר התתי־משימות הופכות חצי שקופות ונעשות “רקע” (לא ניתנות לבחירה)
  * נפתח מתחתיה ציר זמן קטן (אותו היגיון, בקנה מידה מתאים)
  * הציר הקטן מייצג את תת־המשימה עצמה
* יציאה:

  * קליק מחוץ לאזור
  * או Esc

---

# אנשים וסטטוס “מחכה ל” (דרגה שלישית)

* מוצגים שמות אנשים כרפרנס טקסטואלי בלבד
* אין מערכת משתמשים, אין הרשאות, אין בדיקת עומסים/זמינות, אין התראות
* סטטוס “מחכה ל” משתמש בשם אדם טקסטואלי ומוצג כחלק מהסטטוס

---

# הערות

* תחת אזור תתי־המשימות יש אזור הערות
* הערות הן טקסט חופשי יחיד (לא רשימה, לא קבצים, לא @אזכורים)

---

# Inline Editing + Undo/Redo + ולידציה

* שמירה של עריכה מקומית: קליק החוצה
* Undo/Redo: חובה

  * מומלץ לממש כ־operation log בצד לקוח כדי לאפשר חזרה/קדימה
* ולידציות:

  * שם ריק מותר (פשוט מציג ריק)
  * end לפני start אסור → חובה למנוע ולסמן שגיאה ב־UI
* מדיניות שמירה לשרת:

  * אין שמירה אוטומטית לכל שינוי
  * יש כפתור “שמור” גלובלי ששולח state מלא ושומר כ־JSON

---

# דף פרויקט (עמוד נפרד)

* נפתח מ־URL ייעודי דרך אייקון כניסה בפרויקט
* מציג רשימה של כל תתי־המשימות של הפרויקט (ללא ציר זמן)
* אין חיפוש/סינון/מיון
* מטרת העמוד: “סקירה טקסטואלית” של המבנה/תכולה בלי ויזואליזציה של זמן

---

# שמירה, גיבויים וקונפליקטים

* אחסון: קובץ JSON בשרת (FastAPI)
* קונפליקט בין שני טאבים:

  * “האחרון מנצח” (Last write wins)
* גיבויים:

  * בכל שמירה גלובלית נוצרת snapshot עם timestamp
* סכימה קשיחה:

  * כן, עם Pydantic + מוכנות למיגרציות עתידיות באמצעות schema_version

---

# הצעת סכימה חלופית (מנורמלת)

המשמעות נשארת זהה, אבל המודל מעודד יישום אחר: במקום קינון כבד של arrays בתוך arrays, שומרים “גרף” של TaskNodes במפה לפי id, עם קשרי parent/children. זה מקל על:

* Undo/Redo
* Patch לפי id
* רינדור ציר זמן (אפשר לפלט רשימות מהר בלי לטייל בעומק כל פעם)

```json
{
  "schema_version": 1,
  "app": {
    "timezone": "Asia/Jerusalem",
    "date_format": "DD/MM/YY",
    "rtl": true,
    "theme": "system"
  },
  "ui_state": {
    "project_order": ["proj_1", "proj_2"],
    "locked_projects_session": {
      "proj_1": { "locked_until_epoch_ms": 1769999999999 }
    },
    "undo": { "stack": [], "redo_stack": [] }
  },
  "projects": {
    "proj_1": {
      "id": "proj_1",
      "title": "שם פרויקט",
      "short_description": "תיאור קצר",
      "detailed_description": "טקסט תיאור מפורט לפרויקט",
      "notebook": "טקסט חופשי - מחברת טיוטה",
      "tags": ["תגית1", "תגית2"],
      "color": "auto",
      "time_range": {
        "start_iso": "2025-12-01T00:00:00+02:00",
        "end_iso": "2026-01-15T00:00:00+02:00",
        "is_user_defined": true
      },
      "milestone_ids": ["task_1"]
    }
  },
  "tasks": {
    "task_1": {
      "id": "task_1",
      "project_id": "proj_1",
      "parent_task_id": null,
      "title": "אבן דרך",
      "details": "תיאור מפורט למשימה",
      "status": { "type": "in_progress", "waiting_for": null },
      "priority": 2,
      "tags": ["תגיתA"],
      "color": "auto",
      "schedule": {
        "mode": "range",
        "start_iso": "2025-12-10T10:00:00+02:00",
        "end_iso": "2025-12-12T18:00:00+02:00"
      },
      "people": ["דני", "נועה"],
      "notes": "טקסט הערות חופשי",
      "child_task_ids": ["task_1_1"]
    },
    "task_1_1": {
      "id": "task_1_1",
      "project_id": "proj_1",
      "parent_task_id": "task_1",
      "title": "תת משימה",
      "details": "תיאור מפורט לתת משימה",
      "status": { "type": "waiting_for", "waiting_for": "דני" },
      "priority": 3,
      "tags": [],
      "color": "auto",
      "schedule": { "mode": "point", "point_iso": "2025-12-11T12:30:00+02:00" },
      "people": ["דני"],
      "notes": "",
      "child_task_ids": []
    }
  },
  "backups": [
    {
      "id": "bkp_20251227_120000",
      "created_at_iso": "2025-12-27T12:00:00+02:00",
      "reason": "manual_save",
      "file_path": "backups/tasks_20251227_120000.json"
    }
  ]
}
```

הערות יישומיות לסכימה:

* `status.type`:

  * `not_started` | `in_progress` | `stuck` | `done` | `waiting_for`
  * אם `waiting_for` אז `waiting_for` חובה
* `schedule.mode`:

  * `range` כולל start/end
  * `point` כולל point_iso בלבד
* `locked_projects_session`:

  * מומלץ לשמור רק ב־session/local storage ולא להסתמך על שרת, כדי להתאים לדרישה “לא נשמר בסגירת דפדפן”

---

# API מוצע (גרסה שמתאימה ל־Local-first + שמירה גלובלית)

מטרה: שרת פשוט שמנהל קובץ JSON + גיבויים.
עדכונים תכופים לא חייבים לגעת בדיסק; רק “שמור” כותב קובץ ומייצר snapshot.

## מערכת וקובץ

* `GET /api/health`

  * בדיקת זמינות
* `GET /api/state`

  * מחזיר state מלא
* `PUT /api/state`

  * שמירה גלובלית: מקבל state מלא, כותב לקובץ, יוצר backup
  * response: `{ saved_at_iso, backup_id }`
* `GET /api/state/backups`

  * רשימת גיבויים
* `POST /api/state/backups/{backup_id}/restore`

  * שחזור מגיבוי (האחרון מנצח)

## אופציונלי (אם רוצים “לוג פעולות” בלי לשנות את עיקרון השמירה)

* `POST /api/state/validate`

  * מקבל state ומחזיר שגיאות סכימה/ולידציה בלי לשמור
* `POST /api/state/patch`

  * מקבל פעולות קטנות (למשל JSON Patch) לצורך בדיקות/נוחות, אבל עדיין לא כותב לדיסק עד `PUT /api/state`

---

# כללי UI קריטיים ליישום

* RTL מלא בכל שכבות ה־UI, כולל:

  * פריסת טקסט
  * מיקום אייקונים
  * חץ הזמן והכיווניות בציר (עבר מימין)
* במובייל:

  * tap קצר מחקה hover
  * drag reorder דרך handle ברור
* Undo/Redo:

  * נשמר בצד לקוח לפחות עד שמירה גלובלית
  * אחרי שמירה גלובלית אפשר לאפס או להשאיר לפי החלטת מימוש, אבל ההתנהגות צריכה להיות עקבית

